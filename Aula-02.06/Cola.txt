// Inicializa os dados no localStorage se ainda não existirem
function inicializarDados() {
    // Verifica se já existe um item chamado "banco" no localStorage
    if (!localStorage.getItem("banco")) {
        // Dados iniciais
        const dados = [
            { id: 1, nome: "Usuario1", login: "Usuario1", senha: "1234" },
            { id: 2, nome: "Usuario2", login: "Usuario2", senha: "4321" },
            { id: 3, nome: "Usuario3", login: "Usuario3", senha: "1234" }
        ];
        // Armazena os dados como JSON no localStorage
        localStorage.setItem("banco", JSON.stringify(dados));
    }
}

// Retorna o banco de dados do localStorage já convertido de JSON para objeto
function obterBanco() {
    return JSON.parse(localStorage.getItem("banco")) || [];
}

// Salva o banco de dados (objeto) no localStorage como JSON
function salvarBanco(banco) {
    localStorage.setItem("banco", JSON.stringify(banco));
}

// Exibe os dados no elemento HTML com id "tabela"
function mostrarTabela(dados) {
    const tabela = document.getElementById("tabela");

    // Gera uma lista <ul> com os nomes e IDs
    tabela.innerHTML = "<ul>" + dados.map(d => `<li>${d.id} - ${d.nome}</li>`).join("") + "</ul>";
}

// Busca usuários pelo nome digitado no input
function buscar() {
    const termo = document.getElementById("pesquisar").value.toLowerCase(); // Pega o termo em minúsculas
    const banco = obterBanco(); // Pega todos os usuários
    const resultado = banco.filter(item => item.nome.toLowerCase().includes(termo)); // Filtra pelo nome
    mostrarTabela(resultado); // Mostra o resultado na tela
}

// Cadastra um novo usuário
function cadastrar() {
    const nome = prompt("Nome:");   // Pede o nome
    const login = prompt("Login:"); // Pede o login
    const senha = prompt("Senha:"); // Pede a senha

    const banco = obterBanco(); // Pega os dados existentes

    // Cria novo objeto de usuário
    const novo = {
        id: banco.length ? banco[banco.length - 1].id + 1 : 1, // Gera novo ID automaticamente
        nome,
        login,
        senha
    };

    banco.push(novo);       // Adiciona o novo usuário ao banco
    salvarBanco(banco);     // Salva no localStorage
    mostrarTabela(banco);   // Atualiza a exibição
}

// Atualiza um usuário existente
function atualizar() {
    const id = parseInt(prompt("ID do usuário a atualizar:")); // Pede o ID

    const banco = obterBanco(); // Pega os dados
    const index = banco.findIndex(u => u.id === id); // Encontra o índice do usuário

    if (index !== -1) {
        // Atualiza os campos com novos valores (ou mantém os antigos se não alterar)
        banco[index].nome = prompt("Novo nome:", banco[index].nome);
        banco[index].login = prompt("Novo login:", banco[index].login);
        banco[index].senha = prompt("Nova senha:", banco[index].senha);

        salvarBanco(banco);     // Salva alterações
        mostrarTabela(banco);   // Atualiza exibição
    } else {
        alert("Usuário não encontrado.");
    }
}

// Apaga um usuário com base no ID
function apagar() {
    const id = parseInt(prompt("ID do usuário a apagar:")); // Pede o ID

    let banco = obterBanco(); // Pega os dados
    banco = banco.filter(u => u.id !== id); // Remove o usuário com esse ID

    salvarBanco(banco);     // Salva novo banco
    mostrarTabela(banco);   // Atualiza exibição
}

// ---- Execução inicial ao carregar a página ----

// Garante que os dados estejam inicializados no localStorage
inicializarDados();

// Exibe todos os usuários na tela ao carregar
mostrarTabela(obterBanco());
